@page "/user/password/reset"
@model Alpaki.WebApi.Pages.PasswordReset

@{
    Layout = null;
}
<!DOCTYPE html>

<html>
<head>
	<title></title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" integrity="sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA==" crossorigin="anonymous" />
</head>
<body>
	<div class="container padding-bottom-3x mb-2 mt-5">
		<div class="row justify-content-center">
            <div class="col-md-6 offset-md-3">
                <!-- form card change password -->
                <div class="card card-outline-secondary">
                    <div class="card-header">
                        <h3 class="mb-0">Zmień hasło</h3>
                    </div>
                    <div class="card-body">
                        <form class="form" role="form" autocomplete="off" id="form">
                            <div class="form-group">
                                <label for="password">Nowe hasło</label>
                                <input type="password" class="form-control" id="password" name="password">
                            </div>
                            <div class="form-group">
                                <label for="password_confirm">Powtórz hasło</label>
                                <input type="password" class="form-control" id="password_confirm" name="password_confirm">
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-success btn-lg float-right" id="submit">Zamień hasło</button>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- /form card change password -->
            </div>
		</div>
	</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js" integrity="sha512-UdIMMlVx0HEynClOIFSyOrPggomfhBKJE28LKl8yR3ghkgugPnG6iLfRfHwushZl1MOPSY6TsuBDGPK2X4zYKg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/additional-methods.min.js" integrity="sha512-6Uv+497AWTmj/6V14BsQioPrm3kgwmK9HYIyWP+vClykX52b0zrDGP7lajZoIY1nNlX4oQuh7zsGjmF7D0VZYA==" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous"></script>
	<script>
        $.fn.serializeObject = function() {
                const o = {};
                const a = this.serializeArray();
                $.each(a, function() {
                    if (o[this.name]) {
                        if (!o[this.name].push) {
                            o[this.name] = [o[this.name]];
                        }
                        o[this.name].push(this.value || '');
                    } else {
                        o[this.name] = this.value || '';
                    }
                });
                return o;
            };
		 $(document).ready(()=>{
		     const userId = @Request.Query["userId"]
		     const token = "@Request.Query["token"]"		     
		     $("#form").validate({
		        rules:{
		            password: {
		                minlength: 8,
		                required:true
                    },
		            password_confirm: {
                        equalTo: "#password"
                    }
                },
                messages:{
                    password: "Hasło musi być dłuższe niż 8 znaków",
                    password_confirm: "Hasło się nie zgadza"
                },
                submitHandler: function(form) {
		            const data = $(form).serializeObject();
		            $.ajax({
		            	url: "@Url.Action("ResetPassword","User")",
		            	method: "POST",
		            	data: JSON.stringify({
							userId:userId,
							token:token,
							password: data.password
						}), 
		            	dataType: "json",
		            	contentType: "application/json;charset=utf-8", 
		            }).done((r)=>{
		            	toastr.success('Sukces', 'Twoje hasło zostało zmienione')
		            }).fail((r)=>{
		            	toastr.error('Wystąpił błąd', 'Coś poszło nie tak');
		            });                
                }                
		     }); 	
		 });
	</script>
</body>
</html>